<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>粒子AI生图</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<!-- 引入 Material Symbols 图标库 -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries,typography"></script>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#3b82f6", // blue-500
                        "background-light": "#ffffff", // white
                        "background-dark": "#18181b", // zinc-900
                        "sidebar-yellow": "#FFD900",
                    },
                    fontFamily: {
                        display: ["Inter", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "0.75rem", // rounded-xl
                        'full': '9999px',
                    },
                },
            },
        };
    </script>
<style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 300, 'GRAD' 0, 'opsz' 24;
        }
        .pattern-bg {
            background-image:
                radial-gradient(circle at 1px 1px, rgba(0,0,0,0.15) 1px, transparent 0),
                radial-gradient(circle at 11px 11px, rgba(0,0,0,0.15) 1px, transparent 0);
            background-size: 20px 20px;
        }
        html.dark .pattern-bg {background-image:
                radial-gradient(circle at 1px 1px, rgba(0,0,0,0.25) 1px, transparent 0),
                radial-gradient(circle at 11px 11px, rgba(0,0,0,0.25) 1px, transparent 0);
        }
        .switch-btn[aria-checked="true"] {
            background-color: #000;
        }
        .switch-btn[aria-checked="true"] .switch-dot {
            transform: translateX(1.25rem); /* 5 * 0.25rem = 20px */
        }
        /* 优化折叠效果的辅助类 */
        #sidebar.is-collapsed .sidebar-text {
            display: none;
        }
        #sidebar.is-collapsed .sidebar-full-content {
            display: none;
        }
        #sidebar.is-collapsed .sidebar-icon-content {
            display: flex; /* 折叠时显示 */
        }
        .sidebar-icon-content {
            display: none; /* 默认隐藏 */
            align-items: center;
            justify-content: center;
        }
</style>
</head>
<body class="bg-background-light dark:bg-zinc-800 font-display text-gray-800 dark:text-gray-200">
<div class="flex h-screen w-full bg-white dark:bg-zinc-900">

<!-- 1. 左侧侧边栏 -->
<aside id="sidebar" class="w-[340px] p-6 bg-sidebar-yellow dark:bg-sidebar-yellow text-black flex flex-col gap-6 shrink-0 relative transition-all duration-300">
    
    <!-- 展开时的 Logo 和标题 -->
    <div class="flex items-center justify-between sidebar-full-content">
        <div class="flex items-center gap-3">
            <div class="flex flex-col">
                <div class="flex items-center space-x-1">
                    <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                    <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                    <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                </div>
                <div class="flex items-center space-x-1 mt-1">
                    <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                    <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                </div>
            </div>
            <h1 class="font-bold text-lg tracking-wider sidebar-text">基本粒子</h1>
        </div>
    </div>
    
    <!-- 折叠时的 Logo 图标 -->
    <div class="sidebar-icon-content h-10">
        <div class="flex flex-col">
            <div class="flex items-center space-x-1">
                <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
            </div>
            <div class="flex items-center space-x-1 mt-1">
                <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
                <span class="w-1.5 h-1.5 bg-black rounded-full"></span>
            </div>
        </div>
    </div>
    
    <!-- 上传区域 -->
    <div class="space-y-4">
        <div class="flex justify-between items-center sidebar-full-content">
            <span class="text-sm font-semibold sidebar-text">上传图片</span>
            <button id="add-upload-row-btn" class="w-8 h-8 flex items-center justify-center bg-black/5 rounded-lg text-xl hover:bg-black/10 transition-colors">+</button>
        </div>
        <!-- (已修改) 正方形 (aspect-square), 新图标 (add_photo_alternate) -->
        <label for="main-image-upload" class="flex flex-col items-center justify-center w-full aspect-square border-2 border-dashed border-black/20 rounded-xl bg-black/5 pattern-bg cursor-pointer hover:border-black/40 sidebar-full-content">
            <span class="material-symbols-outlined text-6xl text-black/30">add_photo_alternate</span>
        </label>
        <input id="main-image-upload" type="file" class="sr-only">
        
        <!-- 折叠时的上传图标 -->
        <label for="main-image-upload-icon" class="sidebar-icon-content w-12 h-12 bg-black/5 rounded-xl cursor-pointer hover:bg-black/10">
            <span class="material-symbols-outlined text-3xl text-black/50">add_photo_alternate</span>
        </label>
        <input id="main-image-upload-icon" type="file" class="sr-only">
        
        <!-- 动态上传框容器 -->
        <div id="additional-uploads-container" class="space-y-2 sidebar-full-content">
            <!-- JS 动态添加上传框 -->
        </div>
    </div>
    
    <!-- 尺寸区域 -->
    <div class="space-y-4">
        <h3 class="text-sm font-semibold sidebar-text sidebar-full-content">尺寸</h3>
        <div class="relative sidebar-full-content" id="aspect-ratio-wrapper">
            <!-- 显示当前选择的按钮 -->
            <button id="current-aspect-ratio-btn" class="flex items-center justify-between w-full bg-white/50 border border-black/10 rounded-xl text-black py-3 px-4 transition-all hover:bg-white/80">
                <span id="current-aspect-ratio-display" class="flex items-center gap-2">
                    <span class="w-4 h-4 bg-gray-600 rounded-sm inline-block"></span>
                    <span class="font-medium sidebar-text">1:1</span>
                </span>
                <span class="material-symbols-outlined text-black/40 sidebar-text">expand_more</span>
            </button>
            
            <!-- (已修改) 要求 1: 5个选项, 透明背景 (bg-white/50 backdrop-blur-sm), z-50 -->
            <div id="aspect-ratio-dropdown" class="hidden absolute z-50 w-full mt-1 bg-white/50 backdrop-blur-sm border border-black/10 rounded-lg shadow-lg">
                <div id="aspect-ratio-group" class="grid grid-cols-5 gap-1 p-2">
                    <button class="aspect-ratio-btn flex items-center justify-center bg-transparent border border-transparent p-2 rounded-lg text-sm text-text-light hover:border-black/50 data-[active=true]:bg-black data-[active=true]:border-black" data-active="true" data-ratio="1:1">
                        <span class="w-4 h-4 bg-gray-500 rounded-sm inline-block data-[active=true]:bg-white"></span>
                    </button>
                    <button class="aspect-ratio-btn flex items-center justify-center bg-transparent border border-transparent p-2 rounded-lg text-sm text-text-light hover:border-black/50 data-[active=true]:bg-black data-[active=true]:border-black" data-active="false" data-ratio="3:4">
                        <span class="w-3 h-4 bg-gray-500 rounded-sm inline-block data-[active=true]:bg-white"></span>
                    </button>
                    <button class="aspect-ratio-btn flex items-center justify-center bg-transparent border border-transparent p-2 rounded-lg text-sm text-text-light hover:border-black/50 data-[active=true]:bg-black data-[active=true]:border-black" data-active="false" data-ratio="4:3">
                        <span class="w-4 h-3 bg-gray-500 rounded-sm inline-block data-[active=true]:bg-white"></span>
                    </button>
                    <button class="aspect-ratio-btn flex items-center justify-center bg-transparent border border-transparent p-2 rounded-lg text-sm text-text-light hover:border-black/50 data-[active=true]:bg-black data-[active=true]:border-black" data-active="false" data-ratio="16:9">
                        <span class="w-5 h-3 bg-gray-500 rounded-sm inline-block data-[active=true]:bg-white"></span>
                    </button>
                    <button class="aspect-ratio-btn flex items-center justify-center bg-transparent border border-transparent p-2 rounded-lg text-sm text-text-light hover:border-black/50 data-[active=true]:bg-black data-[active=true]:border-black" data-active="false" data-ratio="9:16">
                        <span class="w-3 h-5 bg-gray-500 rounded-sm inline-block data-[active=true]:bg-white"></span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 折叠时的尺寸图标 -->
        <button id="aspect-ratio-icon-btn" class="sidebar-icon-content w-12 h-12 bg-black/5 rounded-xl cursor-pointer hover:bg-black/10">
            <span class="material-symbols-outlined text-3xl text-black/50">aspect_ratio</span>
        </button>
    </div>

    <!-- 数量区域 -->
    <div class="space-y-4">
        <h3 class="text-sm font-semibold sidebar-text sidebar-full-content">数量</h3>
        <!-- (已修改) 要求 3: p-3 -> p-2.5 -->
        <div id="image-count-group" class="grid grid-cols-4 gap-3 sidebar-full-content">
            <button class="image-count-btn flex items-center justify-center p-2.5 rounded-xl bg-white/50 hover:bg-white/80 transition-colors data-[active=true]:bg-black data-[active=true]:text-white data-[active=true]:font-semibold data-[active=true]:ring-2 data-[active=true]:ring-black" data-active="true">1</button>
            <button class="image-count-btn flex items-center justify-center p-2.5 rounded-xl bg-white/50 hover:bg-white/80 transition-colors data-[active=true]:bg-black data-[active=true]:text-white data-[active=true]:font-semibold data-[active=true]:ring-2 data-[active=true]:ring-black" data-active="false">2</button>
            <button class="image-count-btn flex items-center justify-center p-2.5 rounded-xl bg-white/50 hover:bg-white/80 transition-colors data-[active=true]:bg-black data-[active=true]:text-white data-[active=true]:font-semibold data-[active=true]:ring-2 data-[active=true]:ring-black" data-active="false">3</button>
            <button class="image-count-btn flex items-center justify-center p-2.5 rounded-xl bg-white/50 hover:bg-white/80 transition-colors data-[active=true]:bg-black data-[active=true]:text-white data-[active=true]:font-semibold data-[active=true]:ring-2 data-[active=true]:ring-black" data-active="false">4</button>
        </div>
        
        <!-- 折叠时的数量图标 -->
        <button class="sidebar-icon-content w-12 h-12 bg-black/5 rounded-xl cursor-pointer hover:bg-black/10">
            <span class="material-symbols-outlined text-3xl text-black/50">filter_4</span>
        </button>
    </div>
    
    <!-- 系列图开关 -->
    <div class="flex items-center justify-between sidebar-full-content">
        <span class="text-sm font-semibold sidebar-text">开启系列图</span>
        <button id="series-mode-toggle" aria-checked="false" class="switch-btn relative inline-flex h-7 w-12 shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-black focus:ring-offset-2 bg-black/10" role="switch">
            <span aria-hidden="true" class="switch-dot pointer-events-none inline-block h-6 w-6 transform rounded-full bg-white shadow-lg ring-0 transition duration-200 ease-in-out translate-x-0"></span>
        </button>
    </div>
    
    <!-- 移除左下角用户区域 -->
    <div class="mt-auto pt-8 border-t border-black/10 sidebar-full-content">
        <!-- 内容已删除 -->
    </div>
    
    <!-- 折叠按钮 -->
    <button id="sidebar-toggle-btn" class="absolute top-1/2 -right-3.5 -translate-y-1/2 w-7 h-7 bg-white dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 rounded-full flex items-center justify-center shadow-lg hover:bg-gray-100 dark:hover:bg-zinc-700 transition-colors z-10">
        <span id="toggle-icon-left" class="material-symbols-outlined text-lg">chevron_left</span>
        <span id="toggle-icon-right" class="material-symbols-outlined text-lg hidden">chevron_right</span>
    </button>
</aside>

<!-- 2. 主内容区域 -->
<main class="flex-1 flex flex-col bg-gray-50 dark:bg-zinc-900">
    <!-- (已修改) 要求 2: 移除下边框, 添加 "视频" 和 "收藏" 图标 -->
    <header class="flex items-center justify-end p-4 h-16 shrink-0 border-b-0 border-gray-200 dark:border-zinc-800">
        <div class="flex items-center gap-6">
            <!-- 新增图标 -->
            <button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-zinc-700 transition-colors">
                 <span class="material-symbols-outlined text-xl text-gray-600 dark:text-gray-400">movie</span>
            </button>
            <button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-zinc-700 transition-colors">
                 <span class="material-symbols-outlined text-xl text-gray-600 dark:text-gray-400">favorite</span>
            </button>
            
            <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-yellow-400 text-xl !fill-1">monetization_on</span>
                <span class="text-sm font-semibold">100 Credits</span>
            </div>
            <div class="w-8 h-8 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center text-sm font-bold text-gray-600 dark:text-gray-300">U</div>
        </div>
    </header>
    
    <!-- 内容区 -->
    <div class="flex-1 overflow-y-auto p-8 relative">
        <div id="results-container" class="space-y-8 max-w-7xl mx-auto">
            <!-- JS 动态生成结果 -->
            <div class="text-center text-gray-400 pt-16">
                <span class="material-symbols-outlined text-6xl">auto_awesome</span>
                <p class="mt-4 text-lg">开始您的第一次创作吧</p>
                <p class="text-sm">在底部的输入框输入提示词，点击箭头即可生成。</p>
            </div>
        </div>
        
        <!-- 底部输入框区域 (动态宽度) -->
        <div class="sticky bottom-0 mt-8 -mx-8 px-8 py-4 bg-gradient-to-t from-gray-50/80 dark:from-zinc-900/80 to-transparent backdrop-blur-sm">
            <!-- (已修改) 添加 id="prompt-wrapper", 动态 max-w, transition -->
            <div id="prompt-wrapper" class="relative max-w-4xl mx-auto transition-all duration-300">
                <!-- (已修改) 替换为 input, rounded-full, h-16, 新图标 -->
                <input id="prompt-input" class="w-full h-16 pl-6 pr-56 py-4 rounded-full bg-white dark:bg-zinc-800 border border-gray-200 dark:border-zinc-700 shadow-xl text-base placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:ring-2 focus:ring-yellow-400 focus:outline-none" placeholder="输入提示词..." type="text">
                
                <div class="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1.5">
                    <!-- (已新增) 新图标 -->
                    <button class="w-10 h-10 flex items-center justify-center text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full transition-colors">
                        <span class="material-symbols-outlined text-xl">mic</span>
                    </button>
                    <button class="w-10 h-10 flex items-center justify-center text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full transition-colors">
                        <span class="material-symbols-outlined text-xl">image</span>
                    </button>
                    <button class="w-10 h-10 flex items-center justify-center text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full transition-colors">
                        <span class="material-symbols-outlined text-xl">settings</span>
                    </button>
                    
                    <!-- "AI优化" 按钮 -->
                    <button class="flex items-center gap-2 px-4 py-2.5 rounded-full bg-yellow-400 text-black text-sm font-semibold hover:bg-yellow-500 transition-colors">
                        <span class="material-symbols-outlined text-lg">auto_awesome</span>
                        AI优化
                    </button>
                    <!-- 发送按钮 (rounded-full) -->
                    <button id="generate-btn-bottom" class="w-11 h-11 flex items-center justify-center bg-gray-800 dark:bg-gray-200 text-white dark:text-black rounded-full hover:bg-black dark:hover:bg-white transition-colors">
                        <span class="material-symbols-outlined text-2xl">arrow_upward</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</main>
</div>

<!-- 完整的 JS 逻辑 -->
<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        // --- 按钮组通用逻辑 ---
        function setupButtonGroup(groupId, isDropdownItem = false) {
            const group = document.getElementById(groupId);
            if (!group) return;

            group.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;

                group.querySelectorAll('button').forEach(btn => {
                    btn.dataset.active = 'false';
                    if (btn.classList.contains('image-count-btn')) {
                         btn.classList.remove('bg-black', 'text-white', 'font-semibold', 'ring-2', 'ring-black');
                         btn.classList.add('bg-white/50', 'hover:bg-white/80');
                    }
                    if (btn.classList.contains('aspect-ratio-btn')) {
                        btn.classList.remove('bg-black', 'border-black');
                        btn.querySelector('span')?.classList.remove('bg-white');
                        btn.querySelector('span')?.classList.add('bg-gray-500');
                    }
                });
                
                button.dataset.active = 'true';
                if (button.classList.contains('image-count-btn')) {
                    button.classList.add('bg-black', 'text-white', 'font-semibold', 'ring-2', 'ring-black');
                    button.classList.remove('bg-white/50', 'hover:bg-white/80');
                }
                if (button.classList.contains('aspect-ratio-btn')) {
                    button.classList.add('bg-black', 'border-black');
                    button.querySelector('span')?.classList.add('bg-white');
                    button.querySelector('span')?.classList.remove('bg-gray-500');
                }

                if (isDropdownItem) {
                    const wrapper = group.closest('#aspect-ratio-wrapper');
                    const displaySpan = wrapper.querySelector('#current-aspect-ratio-display');
                    const dropdown = wrapper.querySelector('#aspect-ratio-dropdown');
                    
                    const ratioText = button.dataset.ratio;
                    let iconHTML = '';
                    if (ratioText === '1:1') iconHTML = '<span class="w-4 h-4 bg-gray-600 rounded-sm inline-block"></span>';
                    else if (ratioText === '16:9') iconHTML = '<span class="w-5 h-3 bg-gray-600 rounded-sm inline-block"></span>';
                    else if (ratioText === '3:4') iconHTML = '<span class="w-3 h-4 bg-gray-600 rounded-sm inline-block"></span>';
                    else if (ratioText === '4:3') iconHTML = '<span class="w-4 h-3 bg-gray-600 rounded-sm inline-block"></span>';
                    else if (ratioText === '9:16') iconHTML = '<span class="w-3 h-5 bg-gray-600 rounded-sm inline-block"></span>';

                    displaySpan.innerHTML = `${iconHTML} <span class="font-medium sidebar-text">${ratioText}</span>`;
                    dropdown.classList.add('hidden');
                }
            });
        }

        // 1. 设置数量按钮组
        setupButtonGroup('image-count-group');
        
        // 2. 设置尺寸下拉菜单
        const aspectRatioBtn = document.getElementById('current-aspect-ratio-btn');
        const aspectRatioDropdown = document.getElementById('aspect-ratio-dropdown');
        const aspectRatioIconBtn = document.getElementById('aspect-ratio-icon-btn');
        
        aspectRatioBtn.addEventListener('click', () => {
            aspectRatioDropdown.classList.toggle('hidden');
        });
        aspectRatioIconBtn.addEventListener('click', () => {
             document.getElementById('sidebar-toggle-btn').click();
             setTimeout(() => {
                aspectRatioBtn.click();
             }, 300);
        });
        setupButtonGroup('aspect-ratio-group', true);

        // 3. 动态生成结果
        const generateBtnBottom = document.getElementById('generate-btn-bottom');
        const resultsContainer = document.getElementById('results-container');
        const promptInput = document.getElementById('prompt-input');

        generateBtnBottom.addEventListener('click', () => {
            const promptText = promptInput.value || "新的生成结果...";
            
            const placeholder = resultsContainer.querySelector('.text-center');
            if (placeholder) {
                placeholder.remove();
            }
            
            const countBtn = document.querySelector('#image-count-group button[data-active="true"]');
            const count = countBtn ? parseInt(countBtn.textContent) : 1;

            const newResultGroup = document.createElement('div');
            newResultGroup.className = 'space-y-4';
            
            const header = document.createElement('div');
            header.className = 'flex justify-between items-center';
            header.innerHTML = `
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    ${promptText.substring(0, 40)}${promptText.length > 40 ? '...' : ''}
                </p>
                <button class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-zinc-700 transition-colors"><span class="material-symbols-outlined text-base">more_horiz</span></button>
            `;
            
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-2 md:grid-cols-4 gap-4';
            
            for (let i = 0; i < count; i++) {
                const loadingPlaceholder = document.createElement('div');
                loadingPlaceholder.className = 'w-full aspect-square rounded-lg bg-gray-200 dark:bg-zinc-800 animate-pulse';
                grid.appendChild(loadingPlaceholder);
            }
            
            newResultGroup.appendChild(header);
            newResultGroup.appendChild(grid);
            resultsContainer.insertBefore(newResultGroup, resultsContainer.firstChild);
            
            setTimeout(() => {
                grid.innerHTML = '';
                for (let i = 1; i <= count; i++) {
                    const color1 = Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                    const color2 = Math.floor(Math.random()*16777215).toString(16).padStart(6, '0');
                    
                    const imageWrapper = document.createElement('div');
                    imageWrapper.className = 'relative group w-full aspect-square rounded-xl flex-shrink-0 overflow-hidden';
                    
                    const imageDiv = document.createElement('div');
                    imageDiv.style.backgroundImage = `linear-gradient(to bottom right, #${color1}, #${color2})`;
                    imageDiv.className = 'w-full h-full';
                    
                    const overlay = document.createElement('div');
                    overlay.className = 'absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3';
                    overlay.innerHTML = `
                        <span class="material-symbols-outlined text-white text-2xl cursor-pointer hover:scale-110 p-2" title="修改图片">edit</span>
                        <span class="material-symbols-outlined text-white text-2xl cursor-pointer hover:scale-110 p-2" title="转视频">movie</span>
                        <span class="material-symbols-outlined text-white text-2xl cursor-pointer hover:scale-110 p-2" title="收藏">favorite</span>
                        <span class="material-symbols-outlined text-white text-2xl cursor-pointer hover:scale-110 p-2" title="下载">download</span>
                    `;
                    
                    imageWrapper.appendChild(imageDiv);
                    imageWrapper.appendChild(overlay);
                    grid.appendChild(imageWrapper);
                }
            }, 2000);
        });

        // 4. 动态添加上传框
        const addUploadRowBtn = document.getElementById('add-upload-row-btn');
        const additionalUploadsContainer = document.getElementById('additional-uploads-container');
        let uploadRowCount = 0;
        const maxUploadRows = 3;

        addUploadRowBtn.addEventListener('click', () => {
            if (uploadRowCount >= maxUploadRows) return;
            uploadRowCount++;
            
            const newRow = document.createElement('div');
            newRow.className = 'grid grid-cols-2 gap-2';
            
            const picIndex1 = (uploadRowCount - 1) * 2 + 1;
            const picIndex2 = picIndex1 + 1;

            newRow.innerHTML = `
                <label for="ref-img-${picIndex1}" class="flex flex-col items-center justify-center w-full aspect-square border-2 border-dashed border-black/20 rounded-xl bg-black/5 pattern-bg cursor-pointer hover:border-black/40">
                    <span class="material-symbols-outlined text-3xl text-black/30">add_photo_alternate</span>
                    <span class="text-xs text-black/40 sidebar-text">Pic ${picIndex1}</span>
                </label>
                <input id="ref-img-${picIndex1}" type="file" class="sr-only">
                <label for="ref-img-${picIndex2}" class="flex flex-col items-center justify-center w-full aspect-square border-2 border-dashed border-black/20 rounded-xl bg-black/5 pattern-bg cursor-pointer hover:border-black/40">
                    <span class="material-symbols-outlined text-3xl text-black/30">add_photo_alternate</span>
                    <span class="text-xs text-black/40 sidebar-text">Pic ${picIndex2}</span>
                </label>
                <input id="ref-img-${picIndex2}" type="file" class="sr-only">
            `;
            
            additionalUploadsContainer.appendChild(newRow);
            if (uploadRowCount >= maxUploadRows) {
                addUploadRowBtn.disabled = true;
                addUploadRowBtn.classList.add('opacity-50', 'cursor-not-allowed');
            }
        });

        // 5. 侧边栏折叠
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('sidebar-toggle-btn');
        const iconLeft = document.getElementById('toggle-icon-left');
        const iconRight = document.getElementById('toggle-icon-right');
        const promptWrapper = document.getElementById('prompt-wrapper');

        toggleBtn.addEventListener('click', () => {
            const isCollapsed = sidebar.classList.contains('w-20');
            
            sidebar.classList.toggle('is-collapsed');
            
            if (isCollapsed) {
                // --- 展开 ---
                sidebar.classList.remove('w-20', 'p-4');
                sidebar.classList.add('w-[340px]', 'p-6');
                toggleBtn.classList.remove('-left-3.5');
                toggleBtn.classList.add('-right-3.5');
                iconLeft.classList.remove('hidden');
                iconRight.classList.add('hidden');
                promptWrapper.classList.remove('max-w-7xl');
                promptWrapper.classList.add('max-w-4xl');
            } else {
                // --- 折叠 ---
                sidebar.classList.add('w-20', 'p-4');
                sidebar.classList.remove('w-[340px]', 'p-6');
                toggleBtn.classList.add('-left-3.5');
                toggleBtn.classList.remove('-right-3.5');
                iconLeft.classList.add('hidden');
                iconRight.classList.remove('hidden');
                promptWrapper.classList.add('max-w-7xl');
                promptWrapper.classList.remove('max-w-4xl');
            }
        });

        // 6. 开关系列图
        const seriesToggle = document.getElementById('series-mode-toggle');
        seriesToggle.addEventListener('click', () => {
            const isChecked = seriesToggle.getAttribute('aria-checked') === 'true';
            seriesToggle.setAttribute('aria-checked', !isChecked);
        });

    });
</script>

</body></html>